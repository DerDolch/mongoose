%h3.breadcrumb
  %span
    = link_to 'Products', products_path
    = " / " + "#{@product.name} [#{@product.identifier}] (#{@product.status})"

%h2 Product Description:

%p
  %strong Description:
  = @product.description

%br

%div#tabs
  %ul
    %li
      =link_to 'Backlog', '#backlog'
    - @product.releases.each do |release|
      %li
        =link_to release.name, "#release_#{release.id}"
      
  %div#backlog
    %ul.sortable.connectedSortable
      - @product.stories.each do |story|
        %li{:id => "story_#{story.id}", :class => "ui-state-highlight"}
          = story.title
      
  - @product.releases.each do |release|
    %div{:id => "release_#{release.id}"}
      %ul.sortable.connectedSortable
        - @product.stories.each do |story|
          %li{:id => "story_#{release.id}_#{story.id}", :class => "ui-state-highlight"}
            = "#{release.name} => #{story.title}"

%p
  = link_to 'New Story', new_product_story_path(@product), :id => 'story_link_add', :class => 'button'
  = link_to 'Add Release', new_product_release_path(@product), :id => 'release_link_add', :class => 'button'
  = link_to 'Manage Sprints', product_sprints_path(@product), :id => 'sprint_link_manage', :class => 'button'  if current_user.status != "Developer"
  = link_to 'Edit Product', edit_product_path(@product), :id => 'product_link_edit', :class => 'button'  if current_user.status != "Developer"
  = link_to 'Remove Product', product_path(@product), :method => :delete, :confirm => "Are you sure you want to remove #{@product.name}?", :id => 'product_link_remove', :class => 'button'


#container_left

  %h2 Active Sprints
  - if @product.sprints.active.blank?
    %p There are no active sprints for this product.
  - else
    = render :partial => 'sprintstory', :object => @product.sprints.active

  %h2 Completed Sprints
  - if @product.sprints.completed.blank?
    %p There are no completed sprints for this product.
  - else
  = render :partial => 'sprintstory', :object => @product.sprints.completed


#container_right
  %h2 Backlog Stories

  = render :partial => 'storytable', :object => @product.stories.unassigned, :locals => { :sprint_id => nil, :sortable => @mode, :table_inline => 'display: table;'}
  

.clear

- content_for :javascript do
  :javascript
    $(function() {
      $('.sortable').sortable();
      var $tabs = $("#tabs").tabs();
      var $tab_items = $("ul:first li",$tabs).droppable({
        accept: ".connectedSortable li",
        hoverClass: "ui-state-hover",
        drop: function(ev, ui) {
          var $item = $(this);
          var $list = $($item.find('a').attr('href')).find('.connectedSortable');

          ui.draggable.hide('slow', function() {
            $tabs.tabs('select', $tab_items.index($item));
            $(this).appendTo($list).show('slow');
          });
        }
      });
    });
